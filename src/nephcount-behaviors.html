<script>
var NephcountBehaviors = NephcountBehaviors || {};
NephcountBehaviors.DateBehavior = {
  properties: {
    todayString: {
        type: String,
        value: function() {
            return this._formatLocalDate(new Date()).substring(0, 10);
        }
    },
    todayStringStart: {
        type: String,
        value: function() {
            return this._formatLocalDate(new Date()).substring(0, 10) + "T00:00:00";
        }
    },
    todayStringEnd: {
        type: String,
        value: function() {
            return this._formatLocalDate(new Date()).substring(0, 10) + "T23:59:59";
        }
    }
  },
  _formatLocalDate: function (theDate) {
          var now = theDate,
              tzo = -now.getTimezoneOffset(),
              dif = tzo >= 0 ? '+' : '-',
              pad = function(num) {
                  var norm = Math.abs(Math.floor(num));
                  return (norm < 10 ? '0' : '') + norm;
              };
          return now.getFullYear()
              + '-' + pad(now.getMonth()+1)
              + '-' + pad(now.getDate())
              + 'T' + pad(now.getHours())
              + ':' + pad(now.getMinutes())
              + ':' + pad(now.getSeconds())
              + dif + pad(tzo / 60)
              + ':' + pad(tzo % 60);
  }
};

NephcountBehaviors.DataBehavior = {
  _aggregateConsumptionsToNutrientUsages: function(consumptions) {
    var nutrientsArray = [];
    for (var i = 0; i < consumptions.length; i++) {
        var currentNutrients = consumptions[i].nutrientsOfInterest;
        for(var j = 0; j < currentNutrients.length; j++) {
            var currentValue = this.getUnavailableValue(currentNutrients[j].value) * consumptions[i].multiplier;
            if (i === 0) {
                currentNutrients[j].value = currentValue;
                nutrientsArray.push(currentNutrients[j]);
            }
            else {
                for (var k = 0; k < nutrientsArray.length; k++) {
                    if (nutrientsArray[k].nutrient_id === currentNutrients[j].nutrient_id) {
                        nutrientsArray[k].value += currentValue;
                        break;
                    }
                }
            }
        }
    }
    return nutrientsArray;
  },
  getUnavailableValue: function (value) {
      if (value === "--") {
          return 0;
      }
      else {
          return value;
      }
  }

};
</script>
